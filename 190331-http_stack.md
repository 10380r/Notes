# WebブラウザでWebページが表示されるまで
## Agenda
### 登場するプロトコル
- IP
- DNS
- TCP, UDP
- HTTP

#### What is プロトコル
- コンピュータが通信を行うために必要な約束事
- 通信には同じプロトコルを使用する必要がある

#### サーバマシンに接続したい
- インターネット上の無数のマシンから、対象のサーバマシンをどう識別すればいいのか
= IPアドレスを使う  
  - `192.0.43.10` のような数字の羅列
  - これらを住所として目的のサーバにデータを送信する
  - この仕組みを規定しているのが IP(__Internet Protoco__l)  

#### IP
- IPは目的地まで情報を届けるためのプロトコル
- 住所にはIPアドレスを用いるが、その住所まで辿り着く経路選択もIPで行う。
  - 基本戦略は、次はどのルータへ行けば辿り着くのかをルータに尋ねる
  - ルータはどちらへ行けばいいのかの情報(ルーティングケーブル)を持っている

#### IPアドレスに名前をつける
- IPは数字の羅列で覚えづらい
- そこでドメイン名を使用する
  - `example.com` みたいなドメイン名と呼ばれる別名を付け、IPアドレスと紐づけて覚えやすくする
- 紐付けはDNS(__Domain Name Service__)で管理する
  - DNSサーバに聞けばIPアドレスがわかる
```
🙎‍♀️(client) "example.comは？  
🙎‍♂️(DNS)    "192.0.43.10だよー"  
```
- ドメイン名は、rootを頂点とした木構造になっている
- 各階層にDNSサーバが存在し、管理を行う
```
👨‍💻(client) "www.hogehoge.co.jpのIPアドレスは？"  
↓
🙎‍(自組織にあるネームサーバ) "www.hogehoge.co.jpのIPアドレスは？"  
↓
🙎‍(ルートのネームサーバ)    "jpのネームサーバに問い合わせて"  
↓
🙎‍(自組織にあるネームサーバ) "www.hogehoge.co.jpのIPアドレスは？"  
🤴(jpのネームサーバ)              "co.jpのネームサーバに問い合わせて"
🙎‍(自組織にあるネームサーバ) "www.hogehoge.co.jpのIPアドレスは？"  
↓
👨‍🔬(co.jpのネームサーバ)   "hogehoge.co.jpのネームサーバに問い合わせて"
🙎‍(自組織にあるネームサーバ) "www.hogehoge.co.jpのIPアドレスは？"  
↓
👨‍🌾(hogehoge.comのネームサーバ) "210.232.35.70だよ"

🙎‍(自組織にあるネームサーバ) "210.232.35.70だよ"
↓
👨‍💻(client) アクセス
↓
🖥(server) (www.hogehoge.com (IP:210.232.35.70))
```

### Webサーバに接続したい
- サーバマシン上にはsshなどのサーバも動作しており、IPアドレスだけではWebサーバを識別できない  
= ポート番号を指定  
  - サーバの種類(ssh, FTPなど)によってあらかじめポート番号が決められている  
  ex.) Webサーバは80番  
  - この仕組みを規定しているのが`TCP`(__Transmission Control Protocol__)

### TCP
- TCPは事前のやり取りで通信路を確立し、その上で情報をやり取りする
- 投げっぱなしはしない
- エラーチェックや再送など、情報を確実に送るための仕組みを用意している
- よく比較されるものに`UDP`(__User Datagram Protocol__)がある

##### TCP/IPの階層モデル
- TCP/IPは機能を分割し4階層に分けている
- 各階層は下位層から特定のサービスを受け、上位層にサービスを提供する

|階層名 |役割 |主要プロトコル |
|---|______---|---|______---|
|アプリケーション層 |アプリケーションプログラム |HTTP,DNS,SMTP,FTP |
|トランスポート層 |コンピュータ内のプログラム間で通信ができるようにする |TCP,UDP |
|インターネット層 |目的地までパケットを届ける |IP,ICMP |
|ネットワークインターフェース |OSとハードの橋渡し |ARP,RARP |

### UDP
- UDPでもポート番号を同様にしていする
#### 相違点
- 通信路を確立せず、送信要求があると一方的に情報を送信する点
- エラーチェックや再送など、情報を確実に送るための仕組みはない
- 音声や映像など、一定時間内に一定量の情報を送信するものに向いている
```
🙎‍♀️(client) "情報くれ"
🖥(server) "Web届くかわからんけど送るわ。"
```

### 普段ってポート番号指定しないよね
- URLの先頭部分を使用する
  - `http://example.com/`の`http://`でWebページどの通信に用いるプロトコル(HTTP)を指定している  
  → ポート番号80を指定したことになる

### Webページの取得
- まずはHTMLを取得する
- 取得にはHTTP(_HyperText Transfer Protocol_)を用いる
- TCPの通信路を利用してやり取りを行う

### ざっくりHTTP
- リクエストにGETなどのコマンドを使う。他にもPOSTやPUTが存在
- レスポンスには数字3桁のレスポンスコードを使用する
  - 200(OK), 404(Not Found)などなど、、
- これらをヘッダとして送る
- ボディは必要に応じて使う(HTMLデータなど)
- HTTPメッセージはヘッダとボディに分かれる
- ヘッダ
  - リクエストやレスポンスがどんなものかを示す
- ボディ
  - メッセージのデータ
  - 単にデータを取得するリクエストやエラーには存在しない

### ここまでをまとめると
1. DNSでURLのドメイン名からIPアドレスを取得する
2. TCP通信路(TCPコネクション)確立
3. HTTPでリクエストを送りデータ受信

